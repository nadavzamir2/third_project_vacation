# backend/docker-compose.yml
version: "3.9"

services:
  mysql:
    image: mysql:8.0
    container_name: vacations_mysql
    restart: unless-stopped
    ports:
      - "${DB_PORT:-3307}:3306"  # המארח 3307 → בתוך הקונטיינר 3306
    environment:
      MYSQL_ROOT_PASSWORD: "${DB_ROOT_PASSWORD}"
      MYSQL_DATABASE: "${DB_NAME}"
      MYSQL_USER: "${DB_USER}"
      MYSQL_PASSWORD: "${DB_PASSWORD}"
      TZ: "${DB_TIMEZONE:-UTC}"
      LANG: "C.UTF-8"
    command: [
      "--character-set-server=${DB_CHARSET:-utf8mb4}",
      "--collation-server=${DB_COLLATION:-utf8mb4_unicode_ci}",
      "--default-time-zone=+00:00",
      "--explicit_defaults_for_timestamp=ON",
      "--innodb_flush_log_at_trx_commit=1",
      "--sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION"
    ]
    volumes:
      - db_data:/var/lib/mysql
      - ./db/init:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping -h localhost -p${DB_ROOT_PASSWORD} --silent"]
      interval: 10s
      timeout: 5s
      retries: 10

volumes:
  db_data:
